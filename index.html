<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Week 4: Replication Project (Brad Matheson)</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <style>
    .section {
      padding: 1em 0;
    }
    .header {
      background: linear-gradient(to bottom, #337ab7 0%, #135a97 100%);
      color: white;
      padding: 1em 0 2em;
    }
    .footer{
      text-align: right;
      background: linear-gradient(to bottom, #337ab7 0%, #135a97 100%);
      color:#ECF0F1;
      padding: 1em 2em; 
    }
    a {
      color: white;
    }
    svg {
      display: block;
      margin: 0 auto;
    }
    .axis path{
      display: none;
    }
    .axis line {
      fill: none;
      stroke: #ccc;
      shape-rendering: crispEdges;
    }
    .axis text {
      font-size: 11px;
    }
    .label {
      font-weight: 700;
    }
    .point {
      stroke-width: 1;
      opacity: .5;
    }
    .D{
      stroke: #2980B9;
      fill: #2980B9;
    }
    .R{
      stroke: #E74C3C;
      fill: #E74C3C;
    }
    .point.filtered {
      opacity: .05;
    }
    .bar {
      fill: rgb(51, 122, 183);
      opacity: .5;
    }
    .line {
      stroke: rgb(175, 80, 75);
      stroke-width: 2;
    }
  </style>
</head>
<body>
<div class="header section">
  <div class="container">
    <h1>Week 4: Replication Project</h1>
    <p>Comparing congressional candidate partisanship to district partisanship</p>
  </div>
</div>
<div class="controls section">
  <div class="container">
    <div class="btn-toolbar">
      <label for="party">Party: </label>
      <select id="party">
        <option value="all">All</option>
        <option value="rep">Republican</option>
        <option value="dem">Democrat</option>
        <option value="oth">Other</option>
      </select>
    </div>
  </div>
</div>
<div class="main section">
  <div class="container">
    <div id="chart"></div>
  </div>
</div>
<script type="text/javascript" src="https://npmcdn.com/d3@3.5.17/d3.min.js"></script>
<script type="text/javascript" src="https://npmcdn.com/science@1.9.3/science.v1.min.js"></script>
<script type="text/javascript" src="https://npmcdn.com/simple-statistics@2.0.0/dist/simple-statistics.min.js"></script>
<script>
  var data = [];
  var options = {
    party: 'all'
  };
  var svg, x, y;
  var margin = { top: 15, right: 15, bottom: 30, left:45 };
  var width = 640 - margin.right -  margin.left;
  var height = 400 - margin.top - margin.bottom;
  // FETCH DATA
  d3.json('data.json', function (error, json){
    // Call back function
    if (error) { throw error; }
    data = json;
    setup();
    update();
  });

  function setup( ) {
    // SVG
    svg = d3.select('#chart')
      .append('svg')
      .attr('width', width + margin.right + margin.left)
      .attr('height', height + margin.top + margin.bottom)
      .append('g')
      .attr('transform','translate(' + margin.left + ',' + margin.top + ')');
   
    // SCALES
    x = d3.scale.linear()
      .domain([d3.min(data,function (d){ return d.cfScore;}), d3.max(data, function (d){ return d.cfScore; } ) ])
        .range([margin.left,(margin.left + width)])
        .nice();

    y = d3.scale.linear()
      .domain(d3.extent(data, function (d){ return d.distPart; } ))
      .range([(height-margin.top),0])
      .nice();    

    // AXES
    var xAxis = d3.svg.axis()
      .scale(x)
      .tickSize(-height)
      .orient("bottom");
    var yAxis = d3.svg.axis()
      .scale(y)
      .tickSize(-width)
      .orient("left");

    svg.append("g")
      .classed("x axis", true)
      .attr("transform", "translate(0," + (height-margin.top) + ")")
      .call(xAxis);
    svg.append("g")
      .classed("y axis", true)
      .attr("transform","translate(" + margin.left + ",0)")
      .call(yAxis);
    var line = d3.svg.line()
      .x(function(d) { return xScale(d.x); })
      .y(function(d) { return yScale(d.y); });
    svg.append("text")
        .attr("text-anchor", "middle")
        .attr("transform", "translate(0,"+(height/2)+")rotate(-90)")
        .text("District Partisanship");
    svg.append("text")
        .attr("text-anchor", "middle")
        .attr("transform", "translate("+ (width/2) +","+(height + margin.top + (margin.bottom/2))+")")
        .text("Candidate CF Score");
    
    // EVENT HANDLERS
    d3.select('#party').on('change', function () {
      options.party = d3.event.target.value;
      update();
    });
  }
  function update() {
    
    // TRANSFORM
    txData = data.slice();
    if (options.party !== 'all') {
      var party = options.party;
      txData = txData.filter(function (d) {
        return d.party === party;
      });
    }
    
    // SCATTERPLOT
    var points = svg.selectAll('.point')
      .data(txData);

    points.enter().append('circle')
      .classed("point", true)
      .attr('r', 5);
    
    points
      .classed('point',true)
      .classed("R", function (d) {return d.party === "rep";})
      .classed("D", function (d) {return d.party === "dem";})
      .attr('cx', function (d){return x(d.cfScore) ;})
      .attr('cy', function (d){return y(d.distPart) ;});

    points.exit().remove();
    
    // HISTOGRAMS
    // X-HIST
 
    var dataHistX = d3.layout.histogram()
    .bins(x.ticks())
    .value(function (d) {return d.cfScore} )
    (txData);

    var histy = d3.scale.linear()
      .domain([0, d3.max(dataHistX, function (d){ return d.y; } ) ])
      .range(d3.extent(data, function (d){ return d.distPart; } ));

    var histx = d3.scale.linear()
      .domain([0,10])
      .range([0,width]);

    // var ymax = d3.max(dataHistX, function (i) {return i.y});

    // var vert = d3.scale.linear()
    //   .domain( [0, ymax] )
    //   .range([ y.ticks()[0] , y.ticks()[1]]);

    var barWidth = histx(dataHistX[0].dx) ;

    var bar = svg.selectAll(".bar")
        .data(dataHistX)
      .enter().append("g")
        .attr("class", "bar");
        // .attr("transform","translate(0," + margin.top + ")");

    bar.append("rect")
      .attr("x", function (d) { return x(d.x); })
      .attr("width", barWidth)
      .attr("y", function (d) { return y(histy(d.y)); })
      .attr("height", function (d) { return height - margin.top - y(histy(d.y)) ; });
  

    // REGRESSION LINE
  }

</script>

<div class="footer section">
  <p>Source: <a href="http://data.stanford.edu/dime"> <u>Database on Ideology, Money in Politics and Elections (DIME)</u></a></p>
</div>

</body>
</html>